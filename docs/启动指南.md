# 多语言智能客服系统启动指南

## ⚠️ 重要提醒：模型下载

**在启动系统之前，请确保已下载AI模型到本地！**

### 为什么需要下载模型？
- 🚀 **避免启动超时**：本地模型加载比网络下载快很多
- 🔒 **网络稳定性**：不依赖网络连接，避免下载失败
- 💾 **节省时间**：470MB模型文件只需下载一次
- ⚡ **更好的性能**：本地加载提供更快的响应速度

### 模型下载步骤

```bash
# 方法1：使用专门的下载脚本
python download_model.py

# 方法2：测试并自动下载
python test_model_loading.py
```

### 下载状态检查
```bash
# 检查模型是否已正确下载
python test_model_loading.py
```

**如果看到 "✅ 模型加载成功！" 说明下载完成，可以继续启动系统。**

---

## 🚀 启动方式

### 1. 完整启动模式（推荐）
```bash
python run.py
```
- ✅ 预加载AI模型和知识库
- ✅ 完整功能可用
- ⏱️ 首次启动需要几分钟（AI模型加载）
- 🔄 后续启动较快（模型已缓存）

### 2. 快速启动模式
```bash
python quick_start.py
```
- ⚡ 快速启动Web服务器
- ⚠️ AI功能暂不可用（后台加载中）
- 💡 适合快速查看界面或测试

### 3. 简单启动模式
```bash
python simple_main.py
```
- 🎯 最小化功能
- 📝 适合开发和测试

## ⏰ 启动超时问题解决方案

### 问题原因
1. **AI模型加载耗时**：首次加载 `paraphrase-multilingual-MiniLM-L12-v2` 模型需要几分钟
2. **网络连接问题**：API密钥或网络连接不稳定
3. **系统资源不足**：内存或CPU资源不够

### 解决方案

#### 方案1：等待更长时间
- 首次启动时耐心等待5-10分钟
- 观察控制台输出，确认AI模型加载完成
- 看到 "✅ AI模型和知识库预加载完成！" 表示启动成功

#### 方案2：使用快速启动模式
```bash
python quick_start.py
```
- 先启动Web界面
- AI功能在后台继续加载
- 等待几分钟后刷新页面即可使用

#### 方案3：检查配置
1. 确认 `config.py` 中的API密钥配置正确
2. 检查网络连接是否正常
3. 确保有足够的内存（建议4GB以上）

#### 方案4：预加载模型
```bash
python preload_models.py
```
- 单独预加载AI模型
- 减少后续启动时间

## 🔧 故障排除

### 常见错误及解决方法

#### 1. "服务器启动超时"
**原因**：AI模型加载时间过长
**解决**：
- 使用快速启动模式：`python quick_start.py`
- 或等待更长时间（首次启动需要5-10分钟）

#### 2. "AIQIANJI_API_KEY 未设置"
**原因**：配置文件缺少API密钥
**解决**：
- 在 `config.py` 中设置 `AIQIANJI_API_KEY`
- 或使用 `env_example.txt` 作为模板

#### 3. "模型加载失败"
**原因**：网络问题或依赖包缺失
**解决**：
- 检查网络连接
- 运行 `pip install -r requirements.txt`
- 确保安装了 `sentence-transformers`

#### 4. "端口8000被占用"
**原因**：其他服务占用了8000端口
**解决**：
- 关闭占用端口的程序
- 或修改 `run.py` 中的端口号

## 📊 启动状态检查

### 健康检查端点
- `GET /api/health` - 基本健康检查
- `GET /api/status` - 详细系统状态

### 启动成功标志
```
✅ 使用AI千集模型: qwen-plus
✅ 环境检查完成
🌐 启动Web服务器...
🚀 系统启动中，正在预加载AI模型和知识库...
📚 正在加载知识库...
🤖 初始化AI服务...
🔧 初始化API客户端...
✅ 使用API: qwen-plus
📚 初始化知识库...
🔄 正在加载文本向量化模型...
📦 模型名称: paraphrase-multilingual-MiniLM-L12-v2
✅ 文本向量化模型加载成功！耗时: XX.XX秒
✅ AI模型和知识库预加载完成！耗时: XX.XX秒
📊 知识库条目数: XXX
🌐 Web服务器已准备就绪！
✅ 系统启动完成！
```

## 💡 优化建议

### 1. 首次启动优化
- 使用快速启动模式先查看界面
- 在后台等待AI模型加载完成
- 避免重复启动和停止

### 2. 后续启动优化
- 模型已缓存，启动速度会显著提升
- 可以正常使用完整启动模式

### 3. 开发调试
- 使用 `simple_main.py` 进行快速开发和测试
- 使用 `python -m uvicorn api.main:app --reload` 进行热重载开发

## 🆘 获取帮助

如果遇到问题，请：
1. 查看控制台错误信息
2. 检查 `启动指南.md` 中的故障排除部分
3. 确认网络连接和API配置
4. 尝试不同的启动模式

---

**注意**：首次启动时AI模型加载是正常现象，请耐心等待。后续启动会显著加快。